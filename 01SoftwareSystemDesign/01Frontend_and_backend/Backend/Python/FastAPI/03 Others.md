WebSocket è§£å†³â€œèƒ½ä¸èƒ½å®æ—¶é€šä¿¡â€ï¼Œ Socket.IO è§£å†³â€œå®æ—¶é€šä¿¡å¥½ä¸å¥½ç”¨â€ã€‚

WebSocket æ˜¯â€œåŸææ–™â€ï¼ŒSocket.IO æ˜¯â€œæˆå“æ¡†æ¶â€ã€‚ä¸è¦æ‹¿åŸææ–™å»èµ¶å·¥æœŸï¼Œä¹Ÿä¸è¦æ‹¿æˆå“å»é€ ç²¾å¯†ä»ªå™¨ã€‚

| å¯¹æ¯”é¡¹       | WebSocket       | Socket.IO                      |
| ------------ | --------------- | ------------------------------ |
| æœ¬è´¨         | æµè§ˆå™¨æ ‡å‡†åè®®  | åŸºäº WebSocket çš„é€šä¿¡æ¡†æ¶      |
| æ˜¯å¦æ ‡å‡†     | âœ… RFC 6455 æ ‡å‡† | âŒ éæ ‡å‡†ï¼ˆæœ‰è‡ªå·±åè®®ï¼‰         |
| æ˜¯å¦è‡ªåŠ¨é‡è¿ | âŒ å¦            | âœ… æ˜¯                           |
| å¿ƒè·³æ£€æµ‹     | âŒ è‡ªå·±å®ç°      | âœ… å†…ç½®                         |
| äº‹ä»¶æœºåˆ¶     | âŒ åªæœ‰ message  | âœ… æ”¯æŒäº‹ä»¶ï¼ˆemit/onï¼‰          |
| æ–­çº¿æ¢å¤     | âŒ è‡ªå·±å†™        | âœ… å†…ç½®                         |
| åè®®å…¼å®¹æ€§   | é«˜              | ä½ï¼ˆå‰åç«¯å¿…é¡»éƒ½æ˜¯ Socket.IOï¼‰ |
| æ§åˆ¶ç²’åº¦     | é«˜              | ä¸­                             |
| å­¦ä¹ æˆæœ¬     | ä¸­              | ä½                             |
| æ€§èƒ½æé™     | æ›´é«˜            | ç•¥ä½ï¼ˆå¤šä¸€å±‚åè®®ï¼‰             |

é¡¹ç›®ä¸­å¦‚ä½•å¿«é€Ÿé€‰æ‹©ï¼ˆè¯¦æƒ…è§ä¸‹æ–‡ï¼‰ï¼š

- 90% Web é¡¹ç›® â†’ Socket.IO
- 90% é«˜å¹¶å‘/ä½å»¶è¿Ÿ â†’ WebSocket

| æƒ…å†µ         | æ¨è      |
| ------------ | --------- |
| åˆå­¦å®æ—¶é€šä¿¡ | Socket.IO |
| å†™èŠå¤©ç³»ç»Ÿ   | Socket.IO |
| å†™è¡Œæƒ…æ¨é€   | WebSocket |
| å†™æ¸¸æˆ       | WebSocket |
| JS + Python  | Socket.IO |
| Python + C++ | WebSocket |

âŒ åƒä¸‡åˆ«ç”¨ WebSocketï¼Œå¦‚æœä½ åœ¨åšï¼š

- èŠå¤© / åä½œ / é€šçŸ¥
- ç½‘ç»œä¸ç¨³å®šç”¨æˆ·
- å°å›¢é˜Ÿå¿«é€Ÿå¼€å‘
- ä¸æƒ³è‡ªå·±ç»´æŠ¤åè®®

âŒ åƒä¸‡åˆ«ç”¨ Socket.IOï¼Œå¦‚æœä½ åœ¨åšï¼š

- æ¸¸æˆ / è¡Œæƒ… / äº¤æ˜“
- IoT / ç¡¬ä»¶ / å¤šè¯­è¨€å®¢æˆ·ç«¯
- è‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®
- æè‡´æ€§èƒ½ç³»ç»Ÿ



## WebSocket

> WebSocket æ˜¯ä¸€ä¸ªæ ‡å‡†ã€è½»é‡ã€é«˜æ€§èƒ½çš„å®æ—¶é€šä¿¡åè®®ï¼Œä½†åªæä¾›æœ€åŸºç¡€çš„èƒ½åŠ›ã€‚

### 1ã€å®šä¹‰

WebSocket æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œç”¨äºåœ¨å•ä¸ª TCP è¿æ¥ä¸Šå®ç°å…¨åŒå·¥ï¼ˆFull-Duplexï¼‰é€šä¿¡ã€‚

- æ ‡å‡†ï¼šRFC 6455
- ç”±æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŸç”Ÿæ”¯æŒ
- å±äº ä¼ è¾“å±‚ä¹‹ä¸Šçš„åº”ç”¨å±‚åè®®

ä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥éšæ—¶äº’ç›¸å‘é€æ•°æ®ï¼Œè€Œä¸éœ€è¦ HTTP è¯·æ±‚-å“åº”ã€‚



### 2ã€å·¥ä½œåŸç†

å»ºç«‹è¿æ¥æµç¨‹

1. å®¢æˆ·ç«¯å‘èµ· HTTP è¯·æ±‚
2. è¯·æ±‚å¤´ä¸­åŒ…å« `Upgrade: websocket`
3. æœåŠ¡å™¨è¿”å› `101 Switching Protocols`
4. HTTP è¿æ¥å‡çº§ä¸º WebSocket

```
HTTP â†’ WebSocketï¼ˆè¿æ¥åªå»ºç«‹ä¸€æ¬¡ï¼‰
```

ä¹‹åï¼š

- ä¸å†ä½¿ç”¨ HTTP
- åŒæ–¹å¯ä¸»åŠ¨å‘é€æ¶ˆæ¯
- è¿æ¥ä¿æŒç›´åˆ°å…³é—­



### 3ã€æ ¸å¿ƒç‰¹æ€§

âœ… å…¨åŒå·¥é€šä¿¡

- å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ä¸»åŠ¨å‘æ¶ˆæ¯
- æ²¡æœ‰è¯·æ±‚ / å“åº”é™åˆ¶

âœ… é•¿è¿æ¥

- å»ºç«‹ä¸€æ¬¡ï¼ŒæŒç»­é€šä¿¡
- é€‚åˆé«˜é¢‘æ¶ˆæ¯æ¨é€

âœ… åè®®ç®€å•ã€å¼€é”€ä½

- å¸§ç»“æ„è½»é‡
- éå¸¸é€‚åˆé«˜æ€§èƒ½åœºæ™¯

âŒ åŠŸèƒ½éå¸¸â€œåº•å±‚â€

WebSocket **åªæä¾›ï¼š**

```
è¿æ¥ + æ¶ˆæ¯ + å…³é—­
```

**ä¸æä¾›ï¼š**

- äº‹ä»¶
- è‡ªåŠ¨é‡è¿
- å¿ƒè·³æœºåˆ¶
- æ¶ˆæ¯ç¡®è®¤
- æˆ¿é—´ / å¹¿æ’­

è¿™äº›éƒ½éœ€è¦**ä¸šåŠ¡å±‚è‡ªå·±å®ç°**ã€‚



### 4ã€ä½¿ç”¨åœºæ™¯

#### 1ï¼‰é€‚ç”¨åœºæ™¯

é«˜æ€§èƒ½ + åè®®å¯æ§

- å®æ—¶è¡Œæƒ…ï¼ˆè‚¡ç¥¨ã€å¸ä»·ï¼‰
- æ¸¸æˆæœåŠ¡å™¨ï¼ˆä½å»¶è¿Ÿï¼‰
- IoT / è®¾å¤‡é€šä¿¡
- è‡ªå®šä¹‰åè®®ï¼ˆäºŒè¿›åˆ¶ï¼‰
- å’Œé JS å®¢æˆ·ç«¯é€šä¿¡ï¼ˆC++ / Go / Rustï¼‰
- è‡ªå®šä¹‰åè®®é€šä¿¡



#### 2ï¼‰ä¸é€‚ç”¨åœºæ™¯

âŒ 1ï¸âƒ£ å¼ºä¸šåŠ¡å‹å®æ—¶åº”ç”¨ï¼ˆèŠå¤© / åä½œ / é€šçŸ¥ï¼‰

âŒ ä¸é€‚åˆåŸå› 

WebSocket **åªæœ‰â€œè¿æ¥ + æ¶ˆæ¯â€**ï¼Œæ²¡æœ‰ï¼š

- äº‹ä»¶æœºåˆ¶
- è‡ªåŠ¨å¿ƒè·³
- è‡ªåŠ¨é‡è¿
- ç¦»çº¿æ¢å¤
- ACK / é‡è¯•

è¿™æ„å‘³ç€ä½ å¿…é¡»è‡ªå·±å®ç°ï¼š

```
å¿ƒè·³ + é‡è¿ + æ¶ˆæ¯ç¡®è®¤ + é‡å‘ + çŠ¶æ€åŒæ­¥
```

å®é™…åæœ

- èŠå¤©ä¸¢æ¶ˆæ¯
- é¡µé¢åˆ·æ–°è¦é‡æ–°åŒæ­¥çŠ¶æ€
- ç”¨æˆ·ç½‘ç»œæŠ–åŠ¨ç›´æ¥â€œå‡åœ¨çº¿â€
- å®¢æœç³»ç»Ÿç»å¸¸è¢«æŠ•è¯‰â€œæ¶ˆæ¯æ²¡å‘å‡ºå»â€

ğŸ‘‰ **ç»“è®º**

> WebSocket ä¸é€‚åˆâ€œ**ä¸šåŠ¡å¤æ‚ä½†å¯¹å»¶è¿Ÿä¸æç«¯æ•æ„Ÿ**â€çš„åœºæ™¯

------

âŒ 2ï¸âƒ£ å‰ç«¯æ–°æ‰‹ / å°å›¢é˜Ÿ / å¿«é€Ÿè¿­ä»£é¡¹ç›®

âŒ ä¸é€‚åˆåŸå› 

WebSocket **å·¥ç¨‹æˆæœ¬é«˜**ï¼š

- ä½ è¦å®šä¹‰æ¶ˆæ¯åè®®ï¼ˆJSONï¼ŸäºŒè¿›åˆ¶ï¼Ÿï¼‰
- ä½ è¦ç»´æŠ¤æ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬
- ä½ è¦è€ƒè™‘å¼‚å¸¸çŠ¶æ€

```
{
  "type": "chat",
  "payload": {...},
  "version": 3
}
```

å®é™…åæœ

- å‰åç«¯å¯¹åè®®ç†è§£ä¸ä¸€è‡´
- éšç€éœ€æ±‚å¢é•¿ï¼Œåè®®è¶Šæ¥è¶Šæ··ä¹±
- æ”¹ä¸€ä¸ªå­—æ®µï¼Œçº¿ä¸Šå°±ç‚¸

ğŸ‘‰ **ç»“è®º**

> WebSocket ä¸é€‚åˆâ€œ**äººå°‘ + å¿«ä¸Šçº¿ + éœ€æ±‚å˜å¾—å¿«**â€

------

âŒ 3ï¸âƒ£ å¯¹â€œç½‘ç»œä¸ç¨³å®šç”¨æˆ·â€å‹å¥½çš„ç³»ç»Ÿ

ä¾‹å¦‚ï¼š

- ç§»åŠ¨ç«¯ç”¨æˆ·
- æµ·å¤–ç”¨æˆ·
- åœ°é“ / ç”µæ¢¯åœºæ™¯
- Wi-Fi â†” 4G åˆ‡æ¢

âŒ ä¸é€‚åˆåŸå› 

WebSocketï¼š

- ä¸ä¼šè‡ªåŠ¨é‡è¿
- ä¸ä¼šè‡ªåŠ¨æ¢å¤ session
- ä¸ä¼šç¼“å†²äº‹ä»¶

å®é™…åæœ

- å®¢æˆ·ç«¯é¢‘ç¹æ‰çº¿
- åç«¯è¿æ¥æ•°æŠ–åŠ¨ä¸¥é‡
- ç”¨æˆ·çŠ¶æ€ä¸å‡†ç¡®

ğŸ‘‰ **ç»“è®º**

> WebSocket ä¸é€‚åˆâ€œ**å¼±ç½‘ç¯å¢ƒç”¨æˆ·ä¸ºä¸»**â€

------

âŒ 4ï¸âƒ£ éœ€è¦å¹¿æ’­ / æˆ¿é—´ / ç”¨æˆ·ç»„çš„ç³»ç»Ÿï¼ˆå¦‚æœä½ ä¸æƒ³è‡ªå·±å†™ï¼‰

âŒ ä¸é€‚åˆåŸå› 

WebSocket æœ¬èº«æ²¡æœ‰ï¼š

- room
- namespace
- ç”¨æˆ·ç»„

ä½ è¦è‡ªå·±ç»´æŠ¤ï¼š

```
rooms = {
  "room1": [ws1, ws2],
  "room2": [ws3]
}
```

å®é™…åæœ

- æˆ¿é—´ç®¡ç†ä»£ç å¤æ‚
- å†…å­˜æ³„éœ²é£é™©
- å¤šè¿›ç¨‹ / å¤šæœºåŒæ­¥å›°éš¾

ğŸ‘‰ **ç»“è®º**

> WebSocket ä¸é€‚åˆâ€œ**å¤æ‚ç”¨æˆ·å…³ç³»æ¨¡å‹**â€



### 5ã€ç¤ºä¾‹ä»£ç 

```
pip install websockets
```

æœåŠ¡ç«¯ï¼š

```
import asyncio
import websockets

async def handler(websocket):
    print("å®¢æˆ·ç«¯å·²è¿æ¥")
    try:
        async for message in websocket:
            print("æ”¶åˆ°æ¶ˆæ¯:", message)
            await websocket.send(f"æœåŠ¡å™¨æ”¶åˆ°ï¼š{message}")
    except websockets.ConnectionClosed:
        print("å®¢æˆ·ç«¯æ–­å¼€")

async def main():
    async with websockets.serve(handler, "localhost", 8765):
        print("WebSocket æœåŠ¡å¯åŠ¨: ws://localhost:8765")
        await asyncio.Future()  # ä¸€ç›´è¿è¡Œ

asyncio.run(main())

```

å®¢æˆ·ç«¯ï¼š

```
import asyncio
import websockets

async def client():
    uri = "ws://localhost:8765"
    async with websockets.connect(uri) as websocket:
        await websocket.send("Hello WebSocket")
        reply = await websocket.recv()
        print("æœåŠ¡ç«¯å›å¤:", reply)

asyncio.run(client())

```



## Socket.IO

Socket.IO æ˜¯ä¸€ä¸ªâ€œå¸®ä½ æŠŠå®æ—¶é€šä¿¡å¸¸è§é—®é¢˜éƒ½è§£å†³å¥½â€çš„é«˜å±‚æ¡†æ¶ã€‚



### 1ã€å®šä¹‰

Socket.IO æ˜¯ä¸€ä¸ªå®æ—¶é€šä¿¡æ¡†æ¶ï¼ˆåº“ï¼‰ï¼Œæ„å»ºåœ¨ WebSocket ä¹‹ä¸Šï¼Œ
 ä¸ºå¼€å‘è€…æä¾›æ›´é«˜å±‚çš„å®æ—¶é€šä¿¡èƒ½åŠ›ã€‚

- ä¸æ˜¯æ ‡å‡†åè®®
- æœ‰è‡ªå·±çš„é€šä¿¡åè®®
- å‰åç«¯å¿…é¡»éƒ½ä½¿ç”¨ Socket.IO

Socket.IO çš„ç›®æ ‡ä¸æ˜¯â€œåè®®æœ€ç®€å•â€ï¼Œè€Œæ˜¯â€œå¼€å‘æœ€çœäº‹â€ã€‚



### 2ã€å·¥ä½œåŸç†

è¿æ¥é˜¶æ®µï¼ˆç®€åŒ–ï¼‰

```
HTTP æ¡æ‰‹
 â†“
Socket.IO åè®®åå•†
 â†“
WebSocketï¼ˆæˆ–è½®è¯¢ä½œä¸ºé™çº§ï¼‰
```

- ä¼˜å…ˆä½¿ç”¨ WebSocket
- WebSocket ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§
- å¯¹å¼€å‘è€…é€æ˜



### 3ã€æ ¸å¿ƒç‰¹æ€§

âœ… äº‹ä»¶é©±åŠ¨é€šä¿¡

```
socket.emit("chat", data)
socket.on("chat", handler)
```

- å¤©ç„¶è´´åˆä¸šåŠ¡é€»è¾‘
- ä¸ç”¨æ‰‹å†™åè®®å­—æ®µ

------

âœ… è‡ªåŠ¨é‡è¿

- ç½‘ç»œä¸­æ–­è‡ªåŠ¨æ¢å¤
- é‡è¿åç»§ç»­é€šä¿¡

------

âœ… å†…ç½®å¿ƒè·³æœºåˆ¶

- è‡ªåŠ¨æ£€æµ‹æ­»è¿æ¥
- é˜²æ­¢â€œå‡åœ¨çº¿â€

------

âœ… æˆ¿é—´å’Œå‘½åç©ºé—´

- æ”¯æŒç”¨æˆ·åˆ†ç»„
- å¹¿æ’­ã€ç§èŠéå¸¸æ–¹ä¾¿

------

âŒ åè®®å°è£…è¾ƒé‡

- æ¯”åŸç”Ÿ WebSocket å¤šä¸€å±‚åè®®
- æ€§èƒ½ç•¥ä½
- åªèƒ½ Socket.IO â†” Socket.IO é€šä¿¡



### 4ã€ä½¿ç”¨åœºæ™¯

#### é€‚ç”¨åœºæ™¯

å¿«é€Ÿå¼€å‘ + å°‘è¸©å‘

- èŠå¤©ç³»ç»Ÿ
- å®æ—¶é€šçŸ¥
- åä½œåº”ç”¨ï¼ˆåœ¨çº¿æ–‡æ¡£ã€ç™½æ¿ï¼‰
- ç®¡ç†åå°
- å†…ç½‘ç®¡ç†ç³»ç»Ÿ
- Web é¡¹ç›®ä¸ºä¸»ï¼Œå‰åç«¯éƒ½æ˜¯ JS / Python



#### ä¸é€‚ç”¨åœºæ™¯

âŒ 1ï¸âƒ£ é Socket.IO å®¢æˆ·ç«¯çš„ç³»ç»Ÿï¼ˆå¼ºçƒˆä¸é€‚åˆï¼‰

âŒ ä¸é€‚åˆåŸå› ï¼ˆè¿™æ˜¯æœ€å¤§å‘ï¼‰

Socket.IO **ä¸æ˜¯ WebSocket åè®®**ï¼Œè€Œæ˜¯ï¼š

```
HTTP + è‡ªå®šä¹‰åè®® + WebSocket
```

å®é™…åæœ

- åŸç”Ÿ WebSocket å®¢æˆ·ç«¯è¿ä¸ä¸Š
- C++ / Rust / IoT å®¢æˆ·ç«¯å®ç°å›°éš¾
- è°ƒè¯•å·¥å…·å°‘

ğŸ‘‰ **ç»“è®ºï¼ˆéå¸¸é‡è¦ï¼‰**

> Socket.IO ä¸é€‚åˆâ€œ**å¼‚æ„è¯­è¨€ / å¤šç«¯åè®®**â€ç³»ç»Ÿ

------

âŒ 2ï¸âƒ£ å¯¹æè‡´æ€§èƒ½ / è¶…ä½å»¶è¿Ÿè¦æ±‚çš„ç³»ç»Ÿ

âŒ ä¸é€‚åˆåŸå› 

Socket.IO åœ¨ WebSocket ä¹‹ä¸Šå¢åŠ äº†ï¼š

- äº‹ä»¶å°è£…
- JSON ç¼–è§£ç 
- ACK ç®¡ç†
- å¿ƒè·³æœºåˆ¶

å®é™…åæœ

- RTT å¢åŠ 
- QPS é™ä½
- GC å‹åŠ›æ›´å¤§

ğŸ‘‰ å®é™…ç»éªŒæ•°æ®ï¼ˆç²—ç•¥ï¼‰ï¼š

| ç±»å‹      | å•è¿æ¥å»¶è¿Ÿ |
| --------- | ---------- |
| WebSocket | ~1ms       |
| Socket.IO | ~2â€“4ms     |

ğŸ‘‰ **ç»“è®º**

> Socket.IO ä¸é€‚åˆâ€œ**äº¤æ˜“ / æ¸¸æˆ / é«˜é¢‘æ¨é€**â€

------

âŒ 3ï¸âƒ£ äºŒè¿›åˆ¶æµ / è‡ªå®šä¹‰åè®®é€šä¿¡

ä¾‹å¦‚ï¼š

- éŸ³è§†é¢‘æµ
- æ¸¸æˆå¸§åŒæ­¥
- IoT åŸå§‹æ•°æ®

âŒ ä¸é€‚åˆåŸå› 

Socket.IOï¼š

- æ›´åå‘ JSON + äº‹ä»¶
- äºŒè¿›åˆ¶æ”¯æŒæœ‰ï¼Œä½†ä¸è‡ªç„¶
- åè®®å±‚ä¸é€æ˜

å®é™…åæœ

- å¸¦å®½æµªè´¹
- åè®®ä¸ç›´è§‚
- éš¾ä»¥è°ƒè¯•æŠ“åŒ…

ğŸ‘‰ **ç»“è®º**

> Socket.IO ä¸é€‚åˆâ€œ**åè®®çº§é€šä¿¡**â€

------

âŒ 4ï¸âƒ£ é•¿ç”Ÿå‘½å‘¨æœŸã€å¼ºå¯æ§çš„è¿æ¥ç®¡ç†ç³»ç»Ÿ

ä¾‹å¦‚ï¼š

- é‡‘èç³»ç»Ÿ
- é£æ§ç³»ç»Ÿ
- åå°æ§åˆ¶ç³»ç»Ÿ

âŒ ä¸é€‚åˆåŸå› 

Socket.IO ä¼šï¼š

- è‡ªåŠ¨é‡è¿
- è‡ªåŠ¨æ¢å¤ session
- è‡ªåŠ¨å¿ƒè·³

è¿™äº›**â€œè‡ªåŠ¨â€åœ¨æŸäº›ç³»ç»Ÿé‡Œæ˜¯ç¾éš¾**

å®é™…åæœ

- æ— æ³•ç²¾ç¡®åˆ¤æ–­ç”¨æˆ·æ˜¯å¦â€œçœŸçš„åœ¨çº¿â€
- å®‰å…¨ç­–ç•¥éš¾ä»¥å®æ–½
- è¿æ¥çŠ¶æ€ä¸å¯é¢„æµ‹

ğŸ‘‰ **ç»“è®º**

> Socket.IO ä¸é€‚åˆâ€œ**éœ€è¦ç²¾ç¡®è¿æ¥è¯­ä¹‰çš„ç³»ç»Ÿ**â€



### 5ã€ç¤ºä¾‹ä»£ç 

```
pip install "python-socketio[asyncio]" aiohttp
```

æœåŠ¡ç«¯ï¼š

```
import socketio
from aiohttp import web

sio = socketio.AsyncServer(cors_allowed_origins="*")
app = web.Application()
sio.attach(app)

@sio.event
async def connect(sid, environ):
    print("å®¢æˆ·ç«¯è¿æ¥:", sid)

@sio.event
async def message(sid, data):
    print("æ”¶åˆ°æ¶ˆæ¯:", data)
    await sio.emit("message", f"æœåŠ¡å™¨å›å¤ï¼š{data}", to=sid)

@sio.event
async def disconnect(sid):
    print("å®¢æˆ·ç«¯æ–­å¼€:", sid)

web.run_app(app, port=5000)

```

å®¢æˆ·ç«¯ï¼š

```
import socketio

sio = socketio.Client()

@sio.event
def connect():
    print("å·²è¿æ¥æœåŠ¡å™¨")
    sio.send("Hello Socket.IO")

@sio.event
def message(data):
    print("æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯:", data)
    sio.disconnect()

sio.connect("http://localhost:5000")
sio.wait()

```

