官网：

- https://github.com/shareAI-lab/analysis_claude_code
- https://github.com/shareAI-lab/Kode?tab=readme-ov-file



对ClaudeCode的解析及复现



Claude Code 的 Agent Loop 执行流程图 

```
                Agent Loop 执行流程图 (nO函数)
    
    ┌─────────────┐
    │  用户输入   │
    └──────┬──────┘
           │
           ▼
    ┌─────────────┐      ┌──────────────────────────────────┐
    │ 消息预处理  │      │ 1. 消息验证与清理               │
    │ & 上下文检查│◄─────┤ 2. Token使用量评估              │
    └──────┬──────┘      │ 3. 压缩阈值检测 (92%)          │
           │             └──────────────────────────────────┘
           ▼
    ┌─────────────┐      
    │  压缩判断   │      ┌─── 无需压缩
    │ (wU2函数)   │──────┤
    └──────┬──────┘      └─── 需要压缩 ─┐
           │                            │
           ▼                            ▼
    ┌─────────────┐              ┌─────────────┐
    │ 系统提示生成│              │8段式结构化压缩│
    │ (ga0函数)   │              │  AU2算法     │
    └──────┬──────┘              └──────┬──────┘
           │                            │
           ▼◄───────────────────────────┘
    ┌─────────────┐
    │ 会话流生成  │      ┌──────────────────────────────────┐
    │ (wu函数)    │◄─────┤ 1. 模型配置与选择               │
    └──────┬──────┘      │ 2. 流式响应管理                 │
           │             │ 3. 中断信号处理                 │
           ▼             └──────────────────────────────────┘
    ┌─────────────┐
    │对话管道处理 │      ┌──────────────────────────────────┐
    │ (nE2函数)   │◄─────┤ 1. LLM API调用                  │
    └──────┬──────┘      │ 2. 模型降级处理                 │
           │             │ 3. 错误恢复机制                 │
           ▼             └──────────────────────────────────┘
    ┌─────────────┐
    │  工具调用   │      
    │  检测与解析 │──────┬─── 无工具调用 ─┐
    └──────┬──────┘      │                │
           │             └─── 有工具调用  │
           ▼                              │
    ┌─────────────┐                      │
    │MH1工具执行  │      ┌──────────────────────────────────┐
    │  引擎启动   │◄─────┤ 1. 工具发现与验证               │
    └──────┬──────┘      │ 2. 权限检查与门控               │
           │             │ 3. 并发控制调度                 │
           ▼             │ 4. 执行结果处理                 │
    ┌─────────────┐      └──────────────────────────────────┘
    │  结果聚合   │                      │
    │  & 状态更新 │◄─────────────────────┘
    └──────┬──────┘
           │
           ▼
    ┌─────────────┐
    │  循环判断   │──────┬─── 继续循环 ──┐
    │ (继续条件)  │      │               │
    └──────┬──────┘      └─── 结束循环   │
           │                            │
           ▼                            │
    ┌─────────────┐                    │
    │  响应输出   │                    │
    │  & 会话结束 │                    │
    └─────────────┘                    │
           ▲                            │
           └────────────────────────────┘
```
