公司在Gitlab中创建了一个项目，并邀请了Coder01、Coder02、Coder03、Coder04进入项目，Coder01负责项目维护，其他三位负责各自模块的开发。



### 初始化项目

#### 1、从 GitHub 克隆项目并切换到指定 tag

如果是从Github上拉取的开源项目，上传Gitlab前可清空一些历史记录：

```
# 拉取项目
git clone https://github.com/username/project.git
cd project
git checkout tag版本

# 删除所有 Git 相关信息（清除历史）
rm -rf .git
```



#### 2、在 GitLab 上创建一个新项目

1）创建新项目：略

2）（如有需要）修改main分支权限：取消保护

- 登录 GitLab Web 界面，进入项目页面。

- 在左侧菜单里找到： **`Settings` → `Repository` → `Protected branches`**

- 找到 `main` 分支的保护规则。

  - 如果只是不允许强推，可以取消 `Prevent force push`。
  - 如果整个分支是受保护的，可以移除保护或降低限制（例如只读、仅维护者可推送）。

3）秘钥相关

```
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"  // ed25519现代且安全，但是rsa的兼容性最好
cat ~/.ssh/id_rsa.pub
```



#### 3、初始化新的 Git 仓库并推送到 GitLab

```
# 1. 初始化新的 Git 仓库
git init

# 2. 添加远程仓库
git remote remove origin
git remote add origin https://gitlab.com/yourname/new-project.git

# 3. 添加所有文件
git add .

# 4. 提交
git commit -m "Initial commit from GitHub tag v1.2.3"

# 5. 推送到 GitLab 的 main 分支（强制使用 main）
git branch -M main
git push -u origin main // 如果需要强制覆盖，就加上 --force
```



### 新建分支

首先初始化git并添加远程仓库地址（如果还没有）

```
git init
git remote add origin https://gitlab.com/username/target-project.git
```

之后：

```
# 查看当前所在分支
git branch

# 新建分支
git checkout -b feature/new-feature

# 添加并提交文件（如果无修改内容，则无需执行add和commit）
git add .
git commit -m "Initial commit or update for new branch"

# 推送到远程 GitLab 仓库的新分支
git push -u origin feature/new-feature
```



### 合并分支

这里假设`main` 是主干分支，你有三个开发分支，比如 `feature-A`、`feature-B`、`feature-C`，你希望把它们依次合并回 `main` 分支

------

1、确保本地仓库是最新的

```
# 查看当前所在分支
git branch
git checkout main
git pull origin main

# 查看当前有哪些分支
git branch -a
```

------

2、逐个合并分支

合并第一个分支

```
# Step1 切换分支：先切换到main分支上
git checkout main

# Step2 合并：终端此时会反馈有哪些脚本有冲突，在VSCode侧边栏逐个解决冲突即可
git merge feature-A

# Step3 推送：可以无需终端指令，直接在侧边栏鼠标点击推送，也可以一一执行如下终端指令
git add .
git commit -m "描述你的修改"
git push origin main
```

逐个合并其他分支：同上

------



### Developer创建项目

> 涉及到Developer与项目组Owner间权限问题

在 GitLab 的 Group 中：

- **Developer**：不能创建项目
- **Maintainer / Owner**：才能创建项目

所以 Developer 不需要、也不能“新建项目后创建 main 分支”，这种场景不会出现。

对于 Developer，这通常是标准流程：

**1. 由 Owner（或 Maintainer）创建项目**

Owner 创建项目后，项目会自动生成：

- `main` 分支（或 `master`，取决于默认设置）
- 默认受保护（Protected Branch）

**2. Owner 将 Developer 添加到项目中（或继承 Group 权限）**

**3. Developer 克隆项目后，新建自己的开发分支**

例如：

```
git checkout -b feature/my-feature
git push -u origin feature/my-feature
```

**4. Developer 提交 Merge Request（MR）到 main**

因为 main 是受保护分支，所以 Developer **不能直接推送到 main**，但 **可以创建 MR**。

整个流程是：

```
Developer → 提交到 feature 分支 → 发起 Merge Request → Maintainer/Owner Review → 合并到 main
```

------

**如果你们团队希望 Developer 自己创建项目怎么办？**

Owner 可以在 Group 中修改设置：

路径：

```
Group → Settings → General → Permissions → Allowed to create projects
```

将其设置成：

- **Developer + Maintainer**

这样 Developer 才能新建项目。

但注意：即便如此：

- 项目依然会自动生成 main 分支
- Developer 依然无法推送到受保护的 main
- Developer 需要创建自己的分支并发起 MR



### 补充内容

1、查看两个分支的不同：

```
git diff main browser_init_branch  // 按Q退出
```



2、merge也可以在Gitlab 前端（Web UI）处理：

```
Step1：用户可以提交合并请求，或者管理者主动去选择合并
Step2：之后就是处理各种冲突（可以选择放到VSCode上处理），处理完后提交代码
Step3：提交后，GitLab前端的合并请求也会自动结束
```



3、将当前代码既push到main分支又push到另一个已有分支（名为temp-branch）

- 如果当前在main分支上：先push到main，再push到emp-branch 

  ```
  git add .
  git commit -m "your message"  # 如果你需要绕过 pre-commit，就加上 --no-verify 或者 -n
  git push origin main
  
  git push origin HEAD:temp-branch  # 注意加上HEAD
  ```

- 如果当前在temp-branch上：

  ```
  git add .
  git commit -m "your message"  # 如果你需要绕过 pre-commit，就加上 --no-verify 或者 -n
  git push origin temp-branch
  
  git push origin HEAD:main  # 注意加上HEAD
  ```

验证是否成功：确认 main 和 temp-branch 是否都指向了同一个最新 commit。

- 方法一：

  ```
  git log --oneline --decorate --graph --all
  ```

- 方法二：VSCode下载`Git Graph`插件，然后依次点击

  ```
  View → Command Palette → Git Graph: View Git Graph(git log)
  ```



4、如何看懂Git Graph

- https://blog.csdn.net/hao_yan_bing/article/details/121982541
- [代码管理进阶 ➔ Git Graph 插件](https://www.bilibili.com/video/BV1EK4y1w7A7)
